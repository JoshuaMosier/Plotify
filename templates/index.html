{% extends 'layout.html' %}

{% block body %}
        <!-- Bootstrap core JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"></script>
        <!-- Third party plugin JS-->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.min.js"></script>
        <!-- Contact form JS-->
        <script src="{{ url_for('static',filename = '/mail/jqBootstrapValidation.js')}}"></script>
        <!-- Core theme JS-->
        <script src="{{ url_for('static',filename = 'script.js')}}"></script>
        <script src="{{ url_for('static',filename = 'tooltip.js')}}"></script>
        <script src="{{ url_for('static',filename = 'bubble_chart.js')}}"></script>
        <!-- <link rel="stylesheet" href="{{url_for('static',filename='animate.min.css')}}">
        <script src="{{ url_for('static',filename = 'wow.js')}}"></script>
        <script> new WOW().init();</script> -->
        <!-- Enable WebPlayer -->
        <script src="https://sdk.scdn.co/spotify-player.js"></script>
        <script>
          window.onSpotifyWebPlaybackSDKReady = () => {
            var player = new Spotify.Player({
              name: 'Carly Rae Jepsen Player',
              getOAuthToken: callback => {
                // Run code to get a fresh access token

                callback('access token here');
              },
              volume: 0.5
            });
          };
          
          </script>
        
        <!-- Navigation-->
        <nav class="navbar navbar-expand-lg bg-secondary text-uppercase fixed-top" id="mainNav">
            <div class="container">
                <a class="navbar-brand js-scroll-trigger" href="#page-top">Plotify</a>
                <button class="navbar-toggler navbar-toggler-right text-uppercase font-weight-bold bg-primary text-white rounded" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ml-auto">
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#artists">Artists</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#tracks">Tracks</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#genres">Genres</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#dance">Danceability</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#playlist">Playlists</a></li>
                        <li class="nav-item mx-0 mx-lg-1"><a class="nav-link py-3 px-0 px-lg-3 rounded js-scroll-trigger" href="#hist">History</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Masthead-->
        <header class="masthead bg-primary text-white text-center">
            <div class="container d-flex align-items-center flex-column">
                <!-- Masthead Avatar Image-->
                <img class="masthead-avatar mb-5 rounded-circle" src="{{prof_pic}}" alt="" />
                <!-- Masthead Heading-->
                <h1 class="masthead-heading mb-0">Hi {{username}}</h1>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- Masthead Subheading-->
                <!-- <p class="masthead-subheading font-weight-light mb-0"></p> -->
            </div>
        </header>

        <!-- Top Tracks -->
        <section class="page-section" id="artists">
          <div class="container">
              <!-- Contact Section Form-->
              <div class="row">
                  <div class="col-lg-12 mx-auto">
                    <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Your Top Artists</h2>
                    <!-- Icon Divider-->
                    <div class="divider-custom divider-light">
                      <div class="divider-custom-line"></div>
                      <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                      <div class="divider-custom-line"></div>
                  </div>
                      <div class="row justify-content-between">
                        <h4 class="vert-align-text">(Last 4 weeks)</h4>
                        {% for artist in sartists %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{artist[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{artist[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %}  
                        <h4 class="vert-align-text">(Last 6 months)</h4>
                        {% for artist in martists %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{artist[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{artist[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %}  
                        <h4 class="vert-align-text">(Top All Time)<br></h4>
                        {% for artist in lartists %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{artist[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{artist[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %}  
                      </div>
                    </div>
              </div>
          </div>
        </section>
                    <br>
                    <br>
                    <br>
                    <br>
                    <section class="page-section bg-primary" id="tracks">
                      <div class="container">
                    <h2 class="page-section-heading text-center text-uppercase text-white mb-0">Your Top Tracks</h2>
                    <!-- Icon Divider-->
                    <div class="divider-custom divider-light">
                        <div class="divider-custom-line"></div>
                        <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                        <div class="divider-custom-line"></div>
                    </div>
                      <div class="row justify-content-between">
                        <h4 class="vert-align-text">(Last 4 weeks)</h4>
                        {% for track in stracks %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{track[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{track[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %}  
                        <h4 class="vert-align-text">(Last 6 months)</h4>
                        {% for track in mtracks %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{track[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{track[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %} 
                        <h4 class="vert-align-text">(Top All Time)<br></h4>
                        {% for track in ltracks %}
                          <div class="col-md-3 col-lg-3 mb-3">
                            <div class="image-tile">
                              <img class="masthead-avatar rounded-circle image-tile" src="{{track[2]}}" alt="" height='150px'/>
                              <h6 class="art-caption">{{loop.index}}. {{track[0]}}</h6>
                            </div>
                          </div>
                        {% endfor %} 
                      </div>
                    </div>
                      </section>
                      <br>
                      <br>
                      <br>
                      <br>
                      <section class="page-section" id="genres">
                        <div class="container">
                      <h2 class="page-section-heading text-center text-uppercase text-secondary mb-0">Your Top Genres</h2>
                    <!-- Icon Divider-->
                    <div class="divider-custom">
                        <div class="divider-custom-line"></div>
                        <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                        <div class="divider-custom-line"></div>
                    </div>
                    <h6 style="text-align: center;">(Hover to view more)</h6>
                    <div class="row justify-content-between" style="
                    margin: 0 -200px;
                ">
                        <div class="col-lg-4">
                          <div id="vis"></div>
                        </div>
                        <div class="col-lg-5" style="margin: auto 0;">
                          <ul style="list-style-type: none; /* Remove bullets */
                          padding: 0; /* Remove padding */
                          margin: 0; /* Remove margins */">
                            {% for genre in genres %}
                            <li><h6>{{loop.index}}. {{genre}}</h6></li>
                            {% endfor %}
                          </ul>
                        </div>
                    </div>
                    </div>
                  </div>
              </div>
        </section>

        
        
        <!-- Radar -->
        <section class="page-section bg-primary" id="dance">
          <div class="container">
              <!-- Contact Section Form-->
              <div class="row">
                  <div class="col-lg-12 mx-auto">
                    <h2 class="page-section-heading text-center text-uppercase text-white mb-0">Your Most Danceable Songs?</h2>
                    <!-- Icon Divider-->
                    <div class="divider-custom divider-light">
                      <div class="divider-custom-line"></div>
                      <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                      <div class="divider-custom-line"></div>
                  </div>
                    <div class="row justify-content-between">
                      {% for track in danceable %}
                        <div class="col-md-2 col-lg-2 mb-2">
                          <div class="image-tile">
                            <img class="masthead-avatar rounded-circle image-tile" src="{{track[2]}}" alt="" height='150px'/>
                            <h6 class="art-caption">{{loop.index}}. {{track[0]}}</h6>
                            <h6 class="art-caption">Danceability Score: {{track[1]*100}}%</h6>
                          </div>
                        </div>
                      {% endfor %}  
                      
                    </div>
                  </div>
              </div>
          </div>
        </section>
        <!-- About Section-->
        <section class="page-section text-white mb-0" id="playlist">
          <div class="container">
              <!-- About Section Heading-->
              <h2 class="page-section-heading text-center text-uppercase text-secondary">What makes your playlists good?</h2>
              <!-- Icon Divider-->
              <div class="divider-custom">
                <div class="divider-custom-line"></div>
                <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                <div class="divider-custom-line"></div>
            </div>
              <!-- About Section Content-->
              <div class="row justify-content-between">
                <!-- Radar Plots -->
                {% for avg in averaged %}
                <div class="col-md-6 col-lg-6 mb-6 bottom-spacing">
                  <h4 class="art-caption" style="color:#2C3E50;height:50px;">{{plist_names[loop.index-1]}}</h4>
                  <canvas id="test{{loop.index}}" width="600" height="400"></canvas>
                  <script>
                   var marksCanvas = document.getElementById("test{{loop.index}}");

                    var marksData = {
                      labels : [{% for item in radar_labels %}
                                        "{{item}}",
                                      {% endfor %}],
                      datasets: [{
                        label: "{{plist_names[loop.index-1]}}",
                        fill: true,
                                lineTension: 0.1,
                                backgroundColor: "#2C3E50",
                                borderColor: "#2C3E50",
                                borderCapStyle: 'butt',
                                borderDash: [],
                                borderDashOffset: 0.0,
                                borderJoinStyle: 'miter',
                                pointBorderColor: "#2C3E50",
                                pointBackgroundColor: "#fff",
                                pointBorderWidth: 1,
                                pointHoverRadius: 5,
                                pointHoverBackgroundColor: "#2C3E50",
                                pointHoverBorderColor: "#2C3E50",
                                pointHoverBorderWidth: 2,
                                pointRadius: 1,
                                pointHitRadius: 10,
                        backgroundColor: "rgba(200,0,0,0.2)",
                        data : [{% for item in avg %}
                                          {{item}},
                                        {% endfor %}]
                      }]
                    };

                    var radarChart = new Chart(marksCanvas, {
                      type: 'radar',
                      data: marksData,
                      options:{
                      elements:{
                          line:{
                              tension:0,
                              borderWidth:3
                          }
                      },
                      scale: {
                        pointLabels: {
                          fontSize: 16
                        }
                      },
                      legend: {
                          display: false
                      },
                  }
                    });
                  </script>

                  </div>
                {% endfor %}
              </div>
          </div>
      </section>

        <!-- Track Ages -->
        <section class="page-section bg-primary" id="hist">
          <div class="container">
              <!-- Contact Section Heading-->
              <h2 class="page-section-heading text-center text-uppercase text-white mb-0">Your Favorite Tracks by Year</h2>
              <!-- Icon Divider-->
              <div class="divider-custom divider-light">
                <div class="divider-custom-line"></div>
                <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                <div class="divider-custom-line"></div>
            </div>
              <!-- Contact Section Form-->
              <div class="row">
                  <div class="col-lg-8 mx-auto">
                      <div class="row justify-content-center">
                        <!-- bar chart canvas element -->
                        <canvas id="myChart" width="600" height="400"></canvas>
                        <p id="caption">Which year had the best music according to you?</p>
                        <script>
                          // Global parameters:
                          // do not resize the chart canvas when its container does (keep at 600x400px)
                          Chart.defaults.global.responsive = false;
                          
                          // define the chart data
                          var chartData = {
                            labels : [{% for item in labels %}
                                        "{{item}}",
                                      {% endfor %}],
                            datasets : [{
                                label: '{{ legend }}',
                                fill: true,
                                lineTension: 0.1,
                                backgroundColor: "#2C3E50",
                                borderColor: "#2C3E50",
                                borderCapStyle: 'butt',
                                borderDash: [],
                                borderDashOffset: 0.0,
                                borderJoinStyle: 'miter',
                                pointBorderColor: "#2C3E50",
                                pointBackgroundColor: "#fff",
                                pointBorderWidth: 1,
                                pointHoverRadius: 5,
                                pointHoverBackgroundColor: "#2C3E50",
                                pointHoverBorderColor: "#2C3E50",
                                pointHoverBorderWidth: 2,
                                pointRadius: 1,
                                pointHitRadius: 10,
                                data : [{% for item in values %}
                                          {{item}},
                                        {% endfor %}],
                                spanGaps: false
                            }]
                          }
                            
                          // get chart canvas
                          var ctx = document.getElementById("myChart").getContext("2d");
                            
                          // create the chart using the chart canvas
                          var myChart = new Chart(ctx, {
                            type: 'bar',
                            data: chartData,
                            options: { 
                                legend: {
                                  display: false
                                },
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            fontColor: "#2C3E50",
                                            fontSize: 14,
                                            stepSize: 1,
                                            beginAtZero: true
                                        }
                                    }],
                                    xAxes: [{
                                        ticks: {
                                            fontColor: "#2C3E50",
                                            fontSize: 16,
                                            stepSize: 1,
                                            beginAtZero: true
                                        }
                                    }]
                                }
                            }
                          });
                        </script>
                      </div>
                  </div>
              </div>
          </div>
        </section>
    

        <!-- About Section-->
        <section class="page-section bg-secondary text-white mb-0" id="about">
            <div class="container">
                <!-- About Section Heading-->
                <h2 class="page-section-heading text-center text-uppercase text-white">About</h2>
                <!-- Icon Divider-->
                <div class="divider-custom divider-light">
                    <div class="divider-custom-line"></div>
                    <div class="divider-custom-icon"><i class="fas fa-star"></i></div>
                    <div class="divider-custom-line"></div>
                </div>
                <!-- About Section Content-->
                <div class="row">
                    <div class="col-lg-4 ml-auto"><p class="lead">Plotify was inspired by Spotify Unwrapped and aims to showcase a users preference in music in an interesting and creative way.</p></div>
                    <div class="col-lg-4 mr-auto"><p class="lead">This project was developed by Josh Mosier in under 24 hours for Hoohacks 2021.</p></div>
                </div>
            </div>
        </section>
        
        
        <!-- Copyright Section-->
        <div class="copyright py-4 text-center text-white">
            <div class="container"><small>Copyright © Plotify 2021</small></div>
        </div>
        <!-- Scroll to Top Button (Only visible on small and extra-small screen sizes)-->
        <div class="scroll-to-top d-lg-none position-fixed">
            <a class="js-scroll-trigger d-block text-center text-white rounded" href="#page-top"><i class="fa fa-chevron-up"></i></a>
        </div>
{% endblock %}
